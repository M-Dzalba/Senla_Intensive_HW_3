<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.15.xsd">

    <changeSet id="hr-dept" author="Max Dzalba">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="Departments"/>
            </not>
        </preConditions>
        <sqlFile encoding="utf8" path="sql/01.create_departments_table.sql" relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="hr-positions" author="Max Dzalba">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="Positions"/>
            </not>
        </preConditions>
        <sqlFile encoding="utf8" path="sql/02.create_positions_table.sql" relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="hr-employees" author="Max Dzalba">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="Employees"/>
            </not>
        </preConditions>
        <sqlFile encoding="utf8" path="sql/03.create_employees_table.sql" relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="hr-projects" author="Max Dzalba">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="Projects"/>
            </not>
        </preConditions>
        <sqlFile encoding="utf8" path="sql/04.create_projects_table.sql" relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="hr-participation" author="Max Dzalba">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ProjectParticipation"/>
            </not>
        </preConditions>
        <sqlFile encoding="utf8" path="sql/05.create_project_participation_table.sql" relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="hr-indexes" author="Max Dzalba">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM pg_indexes WHERE indexname = 'idx_employees_department';
            </sqlCheck>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM pg_indexes WHERE indexname = 'idx_employees_position';
            </sqlCheck>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM pg_indexes WHERE indexname = 'idx_project_participation_employee';
            </sqlCheck>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM pg_indexes WHERE indexname = 'idx_project_participation_project';
            </sqlCheck>
        </preConditions>
        <sqlFile encoding="utf8" path="sql/06.create_indexes.sql" relativeToChangelogFile="true"/>
    </changeSet>
</databaseChangeLog>